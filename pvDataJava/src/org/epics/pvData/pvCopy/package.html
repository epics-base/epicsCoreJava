<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
  <title>EPICS JavaIOC: pv</title>
</head>

<body>
<h1 style="text-align: center">EPICS PVData: pvCopy<br />
package: org.epics.pvData.pvCopy<br />
2009.06.02</h1>
CONTENTS 
<hr />

<h2 style="text-align: center">Overview</h2>
<hr />

<p>This package provides support for copying PVData between a client and
server. For example the client can be a channel access client and the server
a channel access server. It allows a client to access an arbitrary set of
fields of a PVRecord that exists on the server. This package does not provide
support for transfering the data between client and server but provides
support for code that does, e. g. it can be used by channel access. In the
examples below the data transfer code is called channel access.</p>

<p>PVField and PVStructure provide support for locating a field within a
PVStructure or PVRecord via a field offset. PVField provides the methods:</p>
<dl>
  <dt>getFieldOffset</dt>
    <dd>Get offset of the PVField field within top level structure. Every
      field within the PVStructure has a unique offset. The top level
      structure has an offset of 0. The first field within the structure has
      offset equal to 1. The other offsets are determined by recursively
      traversing each structure of the tree.</dd>
  <dt>getNextFieldOffset</dt>
    <dd>Get the next offset. If the field is a scalar or array field then
      this is just offset + 1. If the field is a structure it is the offset
      of the next field after this structure. Thus (nextOffset - offset) is
      always equal to the number of fields within the field. </dd>
  <dt>getNumberFields</dt>
    <dd>Get the total number of fields in this field. This is equal to
      nextFieldOffset - fieldOffset. </dd>
</dl>

<p>A BitSet which has a bit for each field of a top level PVStructure can be
created via:</p>
<pre>    BitSet bitSet = new BitSet(pvStructure.getNumberFields());</pre>

<p>The offsets for bitSet match the fieldOffsets. On the client side of
Channel Access only a PVStructure a BitSet created from the PVStructure is
required. On the server side PVCopy provides a way to map between the field
in a PVRecord and the fields in the PVStructure. A copy of the PVStructure
resides on both the Channel Access client and server. The client and server
exchange data via these two PVStructures. PVCopy maps between the PVStructure
and the PVRecord on the server side of Channel Access. </p>
<hr />

<h2 style="text-align: center">PVCopy</h2>
<hr />

<p>x</p>
<pre>    interface PVCopy {
        PVRecord getPVRecord();
        Structure getStructure();
        PVStructure createPVStructure();
        int getCopyOffset(PVField recordPVField);
        int getCopyOffset(PVStructure recordPVStructure,PVField recordPVField);
        PVField getRecordPVField(int structureOffset);
        void initCopy(PVStructure pvCopy, BitSet bitSet);
        boolean updateCopy(PVStructure pvCopy,BitSet bitSet);
        boolean updateRecord(PVStructure pvCopy,BitSet bitSet);
        boolean checkBitSet(BitSet bitSet);
    }</pre>

<p>where</p>
<dl>
  <dt><span style="font-family: Courier">getPVRecord</span></dt>
    <dd>x</dd>
  <dt><span style="font-family: Courier">getStructure</span></dt>
    <dd>x</dd>
  <dt><span style="font-family: Courier">createPVStructure</span></dt>
    <dd>x</dd>
  <dt><span style="font-family: Courier">getCopyOffset(PVField
  recordPVField)</span></dt>
    <dd>x</dd>
  <dt><span style="font-family: Courier">getCopyOffset(PVStructure
  recordPVStructure,PVField recordPVField)</span></dt>
    <dd>x</dd>
  <dt><span style="font-family: Courier">getRecordPVField</span></dt>
    <dd>x</dd>
  <dt><span style="font-family: Courier">initCopy</span></dt>
    <dd>x</dd>
  <dt><span style="font-family: Courier">updateCopy</span></dt>
    <dd>x</dd>
  <dt><span style="font-family: Courier">updateRecord</span></dt>
    <dd>x</dd>
  <dt><span style="font-family: Courier">checkBitSet</span></dt>
    <dd>x</dd>
</dl>
<hr />

<h2 style="text-align: center">PVCopyFactory</h2>
<hr />

<h3>Java Definition</h3>
<pre>    class PVCopyFactory {
        static PVCopy create(PVRecord pvRecord,PVStructure pvRequest);
    }</pre>

<p>where create has the arguments</p>
<dl>
  <dt><span style="font-family: Courier">pvRecord</span></dt>
    <dd>The PVRecord to which the server is attached.</dd>
  <dt><span style="font-family: Courier">pvRequest</span></dt>
    <dd>A PVStructure which describes the fields of PVREcord to which the
      server wants access.</dd>
</dl>

<h3>PVStructure pvRequest</h3>

<p>This is a PVStructure that describes the fields in PVRecord that are to be
accessed. It looks like the following:</p>
<pre>    &lt;structure&gt;
        &lt;!-- 0 or more scalar string definitions of the following form --&gt;
        &lt;scalar name = "fieldName" scalarType = "string"&gt;
           fullPVRecordFieldName
        &lt;/scalar&gt;
        &lt;!-- 0 or more structure definitions of the form --&gt;
        &lt;sructure name = "fieldName"&gt;
            &lt;!-- 0 or more scalar string definitions of the following form --&gt;
            &lt;scalar name = "fieldName" scalarType = "string"&gt;
               fullPVRecordFieldName
            &lt;/scalar&gt;
            &lt;!-- 0 or more structure definitions of the form --&gt;
            &lt;sructure name = "fieldName"&gt;
            &lt;/structure&gt;
        &lt;/structure&gt;
    &lt;/structure&gt;</pre>

<p>where</p>
<dl>
  <dt>fieldName</dt>
    <dd>The name of the field that will appear in the field of the
      introspection Structure that is generated from the pvRequest and the
      fullPVRecordFieldName</dd>
  <dt>fullPVRecordFieldName</dt>
    <dd>The full fieldname in PVRecord to which the field of the
      introspection Structure will map.</dd>
</dl>

<p>Note that the definition is recursive, i.e. an arbitarily complex
structure can be defined.</p>
</body>
</html>
