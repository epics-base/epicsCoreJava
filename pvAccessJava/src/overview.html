<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
  <title>EPICS pvAccess</title>
</head>

<body>
<h1 style="text-align: center">EPICS pvAccess<br />
Overview<br />
2010.08.26</h1>
CONTENTS 

<div class="toc">
<ul>
  <li><a href="#Introducti">Introduction</a></li>
  <li><a href="#User">User Interface Packages</a>
    <ul>
      <li><a href="#org.epics.">org.epics.ca</a></li>
      <li><a href="#org.epics.1">org.epics.ca.client</a></li>
      <li><a href="#org.epics.2">org.epics.ca.server.plugins</a></li>
    </ul>
  </li>
  <li><a href="#Problems">Problems and Future Plans</a>
    <ul>
      <li><a href="#Query">Query Facility</a></li>
      <li><a href="#Access">Access Security</a></li>
      <li><a href="#User1">User Controlled Send Queues</a></li>
    </ul>
  </li>
  <li><a href="#Network">Network Protocol</a></li>
  <li><a href="#Helper">Helper Packages</a>
    <ul>
      <li><a href="#org.epics.3">org.epics.ca</a></li>
      <li><a href="#org.epics.4">org.epics.ca.util</a></li>
      <li><a href="#org.epics.5">org.epics.ca.util.logging</a></li>
      <li><a href="#org.epics.6">org.epics.ca.util.sync</a></li>
    </ul>
  </li>
  <li><a href="#Implementa">Implementation Packages</a>
    <ul>
      <li><a href="#org.epics.7">org.epics.ca.impl.remote</a></li>
      <li><a href="#org.epics.8">org.epics.ca.impl.remote.tcp</a></li>
      <li><a href="#org.epics.9">org.epics.ca.impl.remote.udp</a></li>
      <li><a href="#org.epics.10">org.epics.ca.impl.remote.utils</a></li>
    </ul>
  </li>
  <li><a href="#Client">Client Implementation Packages</a>
    <ul>
      <li><a href="#org.epics.11">org.epics.ca.client.impl.remote</a></li>
      <li><a
      href="#org.epics.12">org.epics.ca.client.impl.remote.handlers</a></li>
      <li><a
      href="#org.epics.13">org.epics.ca.client.impl.remote.requests</a></li>
      <li><a href="#org.epics.14">org.epics.ca.client.impl.remote.tcp</a></li>
    </ul>
  </li>
  <li><a href="#Server">Server Implementation Packages</a>
    <ul>
      <li><a href="#org.epics.15">org.epics.ca.server.impl.remote</a></li>
      <li><a
      href="#org.epics.16">org.epics.ca.server.impl.remote.handlers</a></li>
      <li><a
      href="#org.epics.17">org.epics.ca.server.impl.remote.plugins</a></li>
      <li><a
      href="#org.epics.18">org.epics.ca.server.impl.remote.requests</a></li>
      <li><a href="#org.epics.19">org.epics.ca.server.impl.remote.tcp</a></li>
    </ul>
  </li>
  <li><a href="#License">License Agreement</a></li>
</ul>
</div>
<hr />

<h2 style="text-align: center" id="Introducti">Introduction</h2>
<hr />

<p>This product is available via the <a href="#LicenseAgreement">open source
license</a> described at the end of this document.</p>

<p>The javaDOC package overview documents for this project are not complete
but the packages of interest to people writing client code or connecting an
application that wants to start a pvAccess server is complete. What remains
is to fully document the implementation. This project overview gives a brief
description of the packages provided by this project.</p>

<p>This project implements pvAccess, which is an implementation of Channel
Access that fully supports pvData. Package <a
href="org/epics/ca/client/package-summary.html">org.epics.ca.client</a> is of
interest to anyone who wants to write client code for pvAccess and is also of
interest to anyone who wants to write a server that interfaces to other
system. The other packages are mainly of interest to those who want to
understand the internals of the implementation.</p>

<p>If your interest is only to write client code go directly to <a
href="org/epics/ca/client/package-summary.html">org.epics.ca.client</a></p>

<p>This project provides the client and server networking spport for the
interfaces defined in org.epics.ca.client. The javaIOC provides a local
implementation of Channel, which registers itself with the server support
provides by this project. Other implementations of Channel can also be
provided.</p>

<p>This package also allows the following:</p>
<ol>
  <li>An application can be created that provide a pvAccess server that
    provides full support for pvData. This is done by starting a local
    PVDatabase, calling org.epics.ca.LocalFactory.start(), and calling
    org.epics.ca.ServerFactory.start().</li>
  <li>An extensible set of monitoring algorithms is supported. Monitoring is
    defined by project pvData. pvAccess provides access to this facility. A
    default set of monitoring algorithms is provided by pvData but other
    algorithms can be implemented. The code that implements an algorithm must
    extend org.epics.pvData..monitor.AbstractMonitor and register with
    org.epics.ca.server.ChannelServer.</li>
  <li>A query facility is supported. A client can ask that a network query
    request can be made. For example "get the channel list of all Beam
    Position Monitors". A query faciity is registered via a call to (TO BE
    DETERMINED).</li>
  <li>A gateway between pvAccess and other systems can be implemented. For
    example project javaIOC provides gateway code between caV3 and pvAccess.
    It allows a caV3 client to talk to a pvAccess server and allows a
    pvAccess client to talk to a caV3 server. For a pvAccess client the
    gateway implements interface Channel by using JCA/CAJ version 3. It
    implements a caV3 server by accessing the local PVDatabase. See project
    javaIOC (org.epics.ioc.caV3) for an example of what to do. It is complex
    because it is translating between different ways of defining data.</li>
</ol>
<hr />

<h2 style="text-align: center" id="User">User Interface Packages</h2>
<hr />

<p>This section briefly describes the interfaces used by a pvAccess client
and by an application that supports a pvAccess server. It only describes how
things are connected, i.e. it does not describe interface Channel or any of
its related interfaces because they are described in the package overview for
org.epics.ca.client.</p>

<h3 id="org.epics."><a
href="org/epics/ca/package-summary.html">org.epics.ca</a></h3>

<p>This package provides the factories that start the various components of
pvAccess:</p>
<dl>
  <dt><span style="font-family: Courier">ClientFactory</span></dt>
    <dd>This starts the client side of the network support for pvAccess. This
      is the only support that needs to be started by a stand-alone client.
      The example shown in the previous section calls this.</dd>
  <dt><span style="font-family: Courier">ServerFactory</span></dt>
    <dd>This must be started in order to allow pvAccess clients to access the
      local PVDatabase. For example the javaIOC can start this.</dd>
</dl>

<h3 id="org.epics.1"><a
href="org/epics/ca/client/package-summary.html">org.epics.ca.client</a></h3>

<p>This package provides everything required for a pvAccess client. See the
package overview for details. This section only describes how to connect to a
channel and how to register monitor algoritms and channel providers.</p>

<p>To connect to a channel a client does the following:</p>
<pre>    // define the following
    private static final ChannelAccess channelAccess
         = ChannelAccessFactory.getChannelAccess();

    // to connect to a channel must know providerName and ChannelName
    String providerName = "pvAccess";
    String channelName = "someChannel";
    // then
    ChannelProvider channelProvider = channelAccess.getProvider(providerName);
    Channel = channelProvider.createChannel(
        channelName, this, ChannelProvider.PRIORITY_DEFAULT);</pre>

<p>This package defines the interfaces a client uses to comnmunicate with a
pvAccess server. This project fully supports all the interfaces. If a server
is implemented for other systems, it is OK to implement a subset of the
interfaces. For example the caV3 server implemented by the javaIOC does not
support ChannelPutGet because an EPICS V3 IOC does not provide an equivalent
facility.</p>

<p>Except for ChannelAccessFactory, this class contains only Java interface
and enum definition. ChannelAccessFactory provides a complete implementation
of interface ChannelAccess and two static public members:</p>
<pre>public class ChannelAccessFactory {
    public static ChannelAccess getChannelAccess();
    public static void registerChannelProvider(ChannelProvider channelProvider);
}</pre>

<p>where</p>
<dl>
  <dt>getChannelAccess</dt>
    <dd>This gets the single instance of ChannelAccess</dd>
  <dt>registerChannelProvider</dt>
    <dd>This registers a ChannelProvider. User code does not call this. It is
      called via the factories in org.,epics.ca.</dd>
</dl>

<p>ChannelAccess is defined as:</p>
<pre>interface ChannelAccess {
    ChannelProvider getProvider(String providerName);
    String[] getProviderNames();
    PVStructure createRequest(String structureName,String request);
}</pre>

<p>where</p>
<dl>
  <dt>getProvider</dt>
    <dd>Get the channel provider.</dd>
  <dt>getProviderNames</dt>
    <dd>Get the names of all the providers.</dd>
  <dt>createRequest</dt>
    <dd>A convenience method for clients see the package overview for
    details.</dd>
</dl>

<p>ChannelProvider has a method:</p>
Channel createChannel(String channelName, ChannelRequester
channelRequester,short priority); 

<p>This is the method a client calls to connect to a Channel. See the package
overview for details.</p>

<h3 id="org.epics.2">org.epics.ca.server.plugins</h3>

<p>Matej? What to say?</p>
<hr />

<h2 style="text-align: center" id="Problems">Problems and Future Plans</h2>
<hr />

<h3 id="Query">Query Facility</h3>

<p>This needs to be defined and implemented.</p>

<h3 id="Access">Access Security</h3>

<p>Something like how csV3 implements access security is required. A
complication is that for caV3 a client attaches to a single scalar or array
field. For pvAccess a client attaches to an arbirary set of fields in a
record. Takes some thought to decide what to do.</p>

<h3 id="User1">User Controlled Send Queues</h3>

<p>Currently a user can only ask to send a message immediately, i. e. a
client has no control over when a message is sent. This can result in many
short network packets. Perhaps the following should be provided: Allow a
client, for each send request, to specify the following options:</p>
<dl>
  <dt>immediate</dt>
    <dd>Immediately queue a request to the send thread.</dd>
  <dt>periodically</dt>
    <dd>Put requests on a periodic send queue. At some periodic rate the
      queue is transfered to the send thread.</dd>
  <dt>user queue</dt>
    <dd>Client keeps a private queue for requests. The client decides when
      the queue should be transfered to the send thread.</dd>
</dl>
<hr />

<h2 style="text-align: center" id="Network">Network Protocol</h2>
<hr />

<p>Must be described.</p>
<hr />

<h2 style="text-align: center" id="Helper">Helper Packages</h2>
<hr />

<p>This is set of packages that are used by other parts of this project</p>

<h3 id="org.epics.3">org.epics.ca</h3>

<p>This has the following:</p>
<dl>
  <dt>ClientFactory</dt>
    <dd>Starts the client side of remote pvAccess.</dd>
  <dt>ServerFacyory</dt>
    <dd>Starts the server side of remote pvAccess.</dd>
  <dt>CAConstants</dt>
    <dd>A set of constants for pvAccess</dd>
  <dt>CAException</dt>
    <dd>An extension to Exception for pvAccess</dd>
  <dt>Version</dt>
    <dd>Defines the version.</dd>
</dl>

<h3 id="org.epics.4">org.epics.ca.util</h3>

<p>This has the following:</p>
<dl>
  <dt>ArrayFIFO</dt>
    <dd>A FIFO queue.</dd>
  <dt>BasicMutex</dt>
    <dd>Provides lock/unlock. This is used instead of
      java.util.concurrent.locks.ReentrantLock because recursive locking is
      not desired. </dd>
  <dt>CircularBuffer</dt>
    <dd>A fixed size circular buffer. If full a new element replaces the
      oldest.</dd>
  <dt>GrowingCircularBuffer</dt>
    <dd>A circular buffer that holds an unlimited number of elements.</dd>
  <dt>Heap</dt>
    <dd>A heap based priority queue. QUESTION: Is this better than
      java.util.PriorityQueue?</dd>
  <dt>HexDump</dt>
    <dd>Converts a byte array to hex and writes to System.out.println.</dd>
  <dt>InetAddressUtil</dt>
    <dd>Convience methods for INET address conversion.</dd>
  <dt>IntHashMap</dt>
    <dd>An integer hash map. This is used instead of java.util.HashMap so
      that Integer objects do not have to be allocated.</dd>
  <dt>ShortHashMap</dt>
    <dd>A short hash map. This is used instead of java.util.HashMap so that
      Short objects do not have to be allocated.</dd>
  <dt>Timer</dt>
    <dd>QUESTION: Why not use pvData.misc.Timer? It does not require a new to
      add something to the list. Additional methods may have to be
      implemented for pvData.misc.Timer in order to provide the same
      functionality.</dd>
  <dt>TimeStamp</dt>
    <dd>QUESTION: Why not use pvData.property.TimeStamp? It can be changed to
      implement hashCode and equals. </dd>
  <dt>WildcharMatcher</dt>
    <dd>This is implemented instead of java.util.regex.Pattern because of
      code efficency.</dd>
</dl>

<h3 id="org.epics.5">org.epics.ca.util.logging</h3>

<p>A logging facility based on java.util.logging. MATEJ can you describe?</p>

<h3 id="org.epics.6">org.epics.ca.util.sync</h3>

<p>MATEJ can you describe?</p>
<hr />

<h2 style="text-align: center" id="Implementa">Implementation Packages</h2>
<hr />

<p>These packages provide implementation classes and interfaces shared by
both the client and server code for pvAccess</p>

<h3 id="org.epics.7">org.epics.ca.impl.remote</h3>

<p>This package contains enums, interface, and abstract class definitions
common to both the client and server implementation. </p>

<h3 id="org.epics.8">org.epics.ca.impl.remote.tcp</h3>

<p>This contains the code that sends and receives tcp messages. It creates a
send and a receive thread for each tcp connectrion.</p>

<h3 id="org.epics.9">org.epics.ca.impl.remote.udp</h3>

<p>This contains the code that sends and receives udp messages. It creates a
send and a receive thread for each udp connectrion.</p>

<h3 id="org.epics.10">org.epics.ca.impl.remote.utils</h3>

<p>Some network utility support.</p>
<hr />

<h2 style="text-align: center" id="Client">Client Implementation Packages</h2>
<hr />

<p>These packages provide the implementation classes and interfaces for the
client code for pvAccess.</p>

<h3 id="org.epics.11">org.epics.ca.client.impl.remote</h3>

<p>This implements the client side of passing the various ChannelXXX requests
over the network, where XXX is Get, Put, PutGet, etc. This code uses the code
in the following two packages to send requests and receive responses.</p>

<h3 id="org.epics.12">org.epics.ca.client.impl.remote.handlers</h3>

<p>This implements handlers for receiving responses from network requests.</p>

<h3 id="org.epics.13">org.epics.ca.client.impl.remote.requests</h3>

<p>This implements code that sends a network request.</p>

<h3 id="org.epics.14">org.epics.ca.client.impl.remote.tcp</h3>

<p>This interfaces the client code to package
org.epics.ca.impl.remote.tcp.</p>
<hr />

<h2 style="text-align: center" id="Server">Server Implementation Packages</h2>
<hr />

<p>These packages provide the implementation classes and interfaces for the
server code for pvAccess.</p>

<h3 id="org.epics.15">org.epics.ca.server.impl.remote</h3>

<p>This implements the server side of passing the various ChannelXXX requests
over the network, where XXX is Get, Put, PutGet, etc. This code uses the code
in the following two packages to send requests and receive responses. It also
has the code which issues beacons.</p>

<h3 id="org.epics.16">org.epics.ca.server.impl.remote.handlers</h3>

<p>This implements handlers for receiving requests from the client.</p>

<h3 id="org.epics.17">org.epics.ca.server.impl.remote.plugins</h3>

<p>Currently has just code related to beacons.</p>

<h3 id="org.epics.18">org.epics.ca.server.impl.remote.requests</h3>

<p>This implements code that sends responses to the client.</p>

<h3 id="org.epics.19">org.epics.ca.server.impl.remote.tcp</h3>

<p>This interfaces the server code to package
org.epics.ca.impl.remote.tcp.</p>
<hr />

<h2 style="text-align: center" id="License">License Agreement</h2>
<hr />
<pre>Copyright (c) 2007 Control System Laboratory,
    (COSYLAB) Ljubljana Slovenia
Copyright (c) 2008 Martin R. Kraimer
Copyright (c) 2006 The University of Chicago, as Operator of Argonne
     National Laboratory.
Copyright (c) 2006 Deutsches Elektronen-Synchroton,
     Member of the Helmholtz Association, (DESY), HAMBURG, GERMANY.


Permission is hereby granted, free of charge, to any person
obtaining a copy of this software and associated documentation
files (the "Software"), to deal in the Software without
restriction, including without limitation the rights to use,
copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the
Software is furnished to do so, subject to the following
conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.

________________________________________________________________________

This software is in part copyrighted by the University of Chicago (UofC)

In no event shall UofC be liable to any party for direct, indirect,
special, incidental, or consequential damages arising out of the use of
this software, its documentation, or any derivatives thereof, even if
UofC has been advised of the possibility of such damage.

UofC specifically disclaims any warranties, including, but not limited
to, the implied warranties of merchantability, fitness for a particular
purpose, and non-infringement.  This software is provided on an "as is"
basis, and UofC has no obligation to provide maintenance, support,
updates, enhancements, or modifications.

________________________________________________________________________

This software is in part copyrighted by the BERLINER SPEICHERRING
GESELLSCHAFT FUER SYNCHROTRONSTRAHLUNG M.B.H. (BESSY), BERLIN, GERMANY.

In no event shall BESSY be liable to any party for direct, indirect,
special, incidental, or consequential damages arising out of the use of
this software, its documentation, or any derivatives thereof, even if
BESSY has been advised of the possibility of such damage.

BESSY specifically disclaims any warranties, including, but not limited
to, the implied warranties of merchantability, fitness for a particular
purpose, and non-infringement.  This software is provided on an "as is"
basis, and BESSY has no obligation to provide maintenance, support,
updates, enhancements, or modifications.

________________________________________________________________________

This software is in part copyrighted by the Deutsches Elektronen-Synchroton,
    Member of the Helmholtz Association, (DESY), HAMBURG, GERMANY.

In no event shall DESY be liable to any party for direct, indirect,
special, incidental, or consequential damages arising out of the use of
this software, its documentation, or any derivatives thereof, even if
DESY has been advised of the possibility of such damage.

DESY specifically disclaims any warranties, including, but not limited
to, the implied warranties of merchantability, fitness for a particular
purpose, and non-infringement.  This software is provided on an "as is"
basis, and DESY has no obligation to provide maintenance, support,
updates, enhancements, or modifications.
________________________________________________________________________</pre>
</body>
</html>
