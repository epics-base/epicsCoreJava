<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
  <title>EPICS pvAccess Network Protocol</title>
</head>

<body>
<h1 style="text-align: center">EPICS pvAccess Network Protocol<br />
Overview<br />
2009.09.29</h1>
CONTENTS 
<hr />

<h2 style="text-align: center">Introduction</h2>
<hr />

<p>x</p>
<hr />

<h2 style="text-align: center">Network Message</h2>
<hr />

<p>A network message is an ordered sequemce of bytes. In this document
message means network message. A single network packet can hold multiple
messages and a massage can span multiple network packect by being split into
message segments. A message segment must fix in a single network packet.</p>

<p></p>

<p>A message consists of one or more segments. A message segment is encoded
via the frollowing:</p>
<dl>
  <dt>Segment Prefix</dt>
    <dd>A single byte defined below</dd>
  <dt>Segment Length</dt>
    <dd>The number of data bytes in the segment</dd>
  <dt>Segment Data</dt>
    <dd>See next section for a description of how data is encoded.</dd>
</dl>

<p>The segment ptrefix is encoded in binary as FLXXLLLL where:</p>
<dl>
  <dt>F</dt>
    <dd>1 means first segment</dd>
  <dt>L</dt>
    <dd>1 means last segment.</dd>
  <dt>XX</dt>
    <dd>Must be 00</dd>
  <dt>LLLL</dt>
    <dd>(0,1,10) means that length is (1, 2,4) byte inyteger. All other
      values are illegal.</dd>
</dl>

<p>The segmeent length is the number of data bytes in the segment</p>
<hr />

<h2 style="text-align: center">Network Data Elements</h2>
<hr />

<p>Network data consists of a sequence of data elements of well defined
types. The supported types are primitive, string, and array types. Each type
consusts of a type prefix followed by data. A primitive data element must fit
in a single message segment. String and array data elements can span message
segments.</p>

<h3>Primitive Types</h3>

<p>For the primitive types the type prefix is a single byte with the
following values:</p>
<pre>0x00 - boolean false
0x01 - boolean true
0x02 - byte, i.e. 8 bit integer
0x03 - short, i.e. 16 bit integer
0x04 - int, i.e. 32 bit integer
0x05 - ling, i.e. 64 bit integer
0x06 - float, i.e. 32 bit IEEE float
0x07 - double, i.e. 64 bit IEEE double
</pre>

<p>Type boolean has no value bytes. The other types use the number of bytes
required for the type appearing in big endian order. The integer types can be
either signed or unsigned. The application that uses the data decides</p>

<h3>string type</h3>

<p>A string holds a UTF8 encoded character string. A string can span message
segement. Thus a string element consists of a sequence of string segments.
Each string segment consists of a segment prefix and segment data. A string
prefix consists of a one byte prefix type and if it is the first string
segment the string length in bytes. The prefix type is one of the
following:</p>
<pre>0x10 - first string segment
0x20 - last string segment
0x30 - only string segment
0x40 - illegal value
</pre>

<p>The length, which is an unsigned int,is the number of data bytes in the
segment, The entire string segment must reside in a single message
segment.</p>

<h3>array type</h3>

<p>A array consists of an ordered set of elements all of the same element
type. The element type can be any of the primitive types or a string. An
array can span message segments and thus consists of one or more array
segments. Each array segment is encoded are follows:</p>
<pre>0x50 - first array segment
0x60 - last array segment
0x70 - only array segment
</pre>
<p>The array length follows the segment prefix only if it is the first
or only array segment.</p>
<p>The array elements follow. For the primitive types the primitive type
prefix only preceeds the first element. For a string array each elememnt
has the normal string prefix.</p>

</body>
</html>
